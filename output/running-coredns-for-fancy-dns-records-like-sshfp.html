<!DOCTYPE html>
<head>
		<link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
		<link rel="stylesheet" type="text/css" href="/theme/css/pygment.css" />
          <title>Jack Laxson's tech blog - Running CoreDNS for fancy DNS records like SSHFP</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />





</head>

<body id="index" class="home">
		<div id="left-menu">
        <header id="banner" class="body">
                <h1><a href="/">Jack Laxson's tech blog</a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li class="active"><a href="/category/writeup.html">Writeup</a></li>
        </ul></nav><!-- /#menu -->
        </div>
        <main>
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/running-coredns-for-fancy-dns-records-like-sshfp.html" rel="bookmark"
         title="Permalink to Running CoreDNS for fancy DNS records like SSHFP">Running CoreDNS for fancy DNS records like SSHFP</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2020-09-14T00:00:00-04:00">
      Mon 14 September 2020
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/jack-laxson.html">Jack Laxson</a>
    </address>
    <div class="category">
        Category: <a href="/category/writeup.html">Writeup</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>This article will not be going into <a href="https://en.wikipedia.org/wiki/SSHFP_record">sshfp records</a> themselves but feature how to use them if your DNS vendor's server doesn't support them. I was in this situation with my dns registrar, Namecheap.</p>
<p>I was reccomended <a href="https://coredns.io/">CoreDNS</a> as a simple to use, docker-deployment-ready, production DNS server. Its pretty quick to follow their setup guide and have some domains resolve with <code>dig</code>. An important gotcha: openssh requires the records to be signed under DNSSEC. This is fixed by adding the dnssec plugin into your <code>Corefile</code> and generating the applicable keys. <code>sudo dnssec-keygen -a ECDSAP256SHA256 domain.tld</code></p>
<p>In the end my config looked like:</p>
<p>Corefile:</p>
<div class="highlight"><pre><span></span><span class="k">jacklaxson.com</span> <span class="p">{</span>
        <span class="kn">file</span> <span class="s">db.jacklaxson.com</span>
        <span class="s">log</span>
        <span class="s">prometheus</span> <span class="n">0.0.0.0</span><span class="p">:</span><span class="mi">9153</span>
        <span class="s">any</span>
<span class="err">}</span>
</pre></div>


<p>the important (and not sensitive bits) of my zonefile:</p>
<div class="highlight"><pre><span></span>$ORIGIN jacklaxson.com.
@   3600 IN SOA ns.jacklaxson.com. admin.jacklaxson.com. (
                20200831 ; serial
                7200       ; refresh (2 hours)
                3600       ; retry (1 hour)
                1209600    ; expire (2 weeks)
                3600       ; minimum (1 hour)
                )
server.jacklaxson.com IN SSHFP 4 1 43fda19ed10224240a53193635df39456956fcd370dba277e6b69
server.jacklaxson.com IN SSHFP 4 2 8d798f349510224240a53193635df39456956fcd370dba277e6b69cab5e1628e9
</pre></div>


<p>my docker run command: <code>sudo docker run -it -p 127.0.0.1:9153:9153 -p 53:53/tcp -p 53:53/udp -v 
$PWD/db.jacklaxson.com:/db.jacklaxson.com -v $PWD/Corefile:/Corefile -v $PWD/Kjacklaxson.key:/Kjacklaxson.key -v 
$PWD/Kjacklaxson.private:/Kjacklaxson.private --restart=unless-stopped --name coredns coredns/coredns</code></p>
  </div><!-- /.entry-content -->
</section>
        </main>
</body>
</html>